<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Home Control</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f0f2f5;
        }
        .control-card {
            transition: transform 0.2s;
        }
        .control-card:hover {
            transform: translateY(-5px);
        }
        .status-dot {
            height: 10px;
            width: 10px;
            border-radius: 50%;
            display: inline-block;
        }
        .connected {
            background-color: #22c55e;
        }
        .disconnected {
            background-color: #ef4444;
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">
    <div class="max-w-4xl w-full bg-white rounded-xl shadow-xl p-6">
        <div class="flex justify-between items-center mb-6">
            <h1 class="text-2xl font-bold text-gray-800">Smart Home Control</h1>
            <div class="flex items-center">
                <span id="connectionStatus" class="status-dot disconnected"></span>
                <span class="ml-2 text-sm text-gray-600">Disconnected</span>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            <!-- Door Lock Control -->
            <div class="control-card bg-gray-50 p-4 rounded-lg shadow">
                <h2 class="text-lg font-semibold text-gray-700">Door Lock</h2>
                <button id="lockButton" class="mt-2 w-full bg-blue-500 text-white py-2 rounded hover:bg-blue-600" onclick="toggleLock()">Unlock</button>
                <p class="mt-2 text-sm text-gray-600">Status: <span id="lockStatus">Locked</span></p>
            </div>

            <!-- Light Control -->
            <div class="control-card bg-gray-50 p-4 rounded-lg shadow">
                <h2 class="text-lg font-semibold text-gray-700">Light</h2>
                <button id="lightButton" class="mt-2 w-full bg-blue-500 text-white py-2 rounded hover:bg-blue-600" onclick="toggleLight()">Turn On</button>
                <p class="mt-2 text-sm text-gray-600">Status: <span id="lightStatus">Off</span></p>
            </div>

            <!-- Curtain Control -->
            <div class="control-card bg-gray-50 p-4 rounded-lg shadow">
                <h2 class="text-lg font-semibold text-gray-700">Curtain</h2>
                <button id="curtainButton" class="mt-2 w-full bg-blue-500 text-white py-2 rounded hover:bg-blue-600" onclick="toggleCurtain()">Open</button>
                <p class="mt-2 text-sm text-gray-600">Status: <span id="curtainStatus">Closed</span></p>
            </div>
        </div>

        <!-- Environment Monitoring -->
        <div class="mt-6 bg-gray-50 p-4 rounded-lg shadow">
            <h2 class="text-lg font-semibold text-gray-700">Environment Status</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-2">
                <div>
                    <p class="text-sm text-gray-600">Temperature: <span id="temperature">N/A</span> Â°C</p>
                </div>
                <div>
                    <p class="text-sm text-gray-600">Humidity: <span id="humidity">N/A</span> %</p>
                </div>
                <div>
                    <p class="text-sm text-gray-600">Light Level: <span id="lightLevel">N/A</span></p>
                </div>
            </div>
        </div>

        <!-- Alerts -->
        <div class="mt-6 bg-gray-50 p-4 rounded-lg shadow">
            <h2 class="text-lg font-semibold text-gray-700">Alerts</h2>
            <p id="alertMessage" class="mt-2 text-sm text-gray-600">No alerts</p>
        </div>
    </div>

    <script>
        let ws;
        const wsUrl = 'wss://your-esp32-ip:443'; // Replace with your ESP32 WebSocket server URL

        function connectWebSocket() {
            ws = new WebSocket(wsUrl);

            ws.onopen = () => {
                console.log('WebSocket connected');
                document.getElementById('connectionStatus').classList.remove('disconnected');
                document.getElementById('connectionStatus').classList.add('connected');
                document.getElementById('connectionStatus').nextElementSibling.textContent = 'Connected';
            };

            ws.onmessage = (event) => {
                const data = JSON.parse(event.data);
                handleMessage(data);
            };

            ws.onclose = () => {
                console.log('WebSocket disconnected');
                document.getElementById('connectionStatus').classList.remove('connected');
                document.getElementById('connectionStatus').classList.add('disconnected');
                document.getElementById('connectionStatus').nextElementSibling.textContent = 'Disconnected';
                setTimeout(connectWebSocket, 5000); // Reconnect after 5 seconds
            };

            ws.onerror = (error) => {
                console.error('WebSocket error:', error);
            };
        }

        function handleMessage(data) {
            switch (data.type) {
                case 'lock_status':
                    updateLockStatus(data.value);
                    break;
                case 'light_status':
                    updateLightStatus(data.value);
                    break;
                case 'curtain_status':
                    updateCurtainStatus(data.value);
                    break;
                case 'environment':
                    updateEnvironment(data.temperature, data.humidity, data.light);
                    break;
                case 'alert':
                    showAlert(data.message);
                    break;
            }
        }

        function toggleLock() {
            const isLocked = document.getElementById('lockStatus').textContent === 'Locked';
            sendCommand({ type: 'lock', value: isLocked ? 1 : 0 });
        }

        function toggleLight() {
            const isOff = document.getElementById('lightStatus').textContent === 'Off';
            sendCommand({ type: 'light', value: isOff ? 1 : 0 });
        }

        function toggleCurtain() {
            const isClosed = document.getElementById('curtainStatus').textContent === 'Closed';
            sendCommand({ type: 'curtain', value: isClosed ? 1 : 0 });
        }

        function sendCommand(command) {
            if (ws && ws.readyState === WebSocket.OPEN) {
                ws.send(JSON.stringify(command));
            }
        }

        function updateLockStatus(value) {
            const lockButton = document.getElementById('lockButton');
            const lockStatus = document.getElementById('lockStatus');
            if (value) {
                lockButton.textContent = 'Lock';
                lockStatus.textContent = 'Unlocked';
            } else {
                lockButton.textContent = 'Unlock';
                lockStatus.textContent = 'Locked';
            }
        }

        function updateLightStatus(value) {
            const lightButton = document.getElementById('lightButton');
            const lightStatus = document.getElementById('lightStatus');
            if (value) {
                lightButton.textContent = 'Turn Off';
                lightStatus.textContent = 'On';
            } else {
                lightButton.textContent = 'Turn On';
                lightStatus.textContent = 'Off';
            }
        }

        function updateCurtainStatus(value) {
            const curtainButton = document.getElementById('curtainButton');
            const curtainStatus = document.getElementById('curtainStatus');
            if (value) {
                curtainButton.textContent = 'Close';
                curtainStatus.textContent = 'Open';
            } else {
                curtainButton.textContent = 'Open';
                curtainStatus.textContent = 'Closed';
            }
        }

        function updateEnvironment(temp, hum, light) {
            document.getElementById('temperature').textContent = temp.toFixed(1);
            document.getElementById('humidity').textContent = hum.toFixed(1);
            document.getElementById('lightLevel').textContent = light;
        }

        function showAlert(message) {
            document.getElementById('alertMessage').textContent = message;
        }

        // Initialize WebSocket connection
        connectWebSocket();
    </script>
</body>
</html>
